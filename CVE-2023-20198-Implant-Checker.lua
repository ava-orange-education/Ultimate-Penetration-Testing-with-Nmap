description = [[
This script checks for the presence of an implant that has been associated with the exploitation of CVE-2023-20198 which 
allows an unauthenticated user to create a local user of the highest privilege level on Cisco IOS XE Web Management User Interface.
It should be noted, this script checks for the commonly used implant to identify an indicator of compromise (IoC) 
it doesn't not determine the target's vulnerability to the exploit itself. 
]]

author = "Travis DeForge"
license = "Same as Nmap--See https://nmap.org/book/man-legal.html"
categories = {"malware", "safe"}

-- @usage
-- nmap --script CVE-2023-20198-Implant-Checker.nse <target(s)>

-- Define the action function
action = function(host, port)
  local target_ip = host.ip

  -- Define the URL with the target IP addresses
  local url = "https://" .. target_ip .. "/webui/logoutconfirm.html?logon_hash=1"

  -- Execute 
  local command = 'curl -k -X POST "' .. url .. '"'
  local handle = io.popen(command)
  local result = handle:read("*a")
  handle:close()

  -- Print the server response
  return result
end
